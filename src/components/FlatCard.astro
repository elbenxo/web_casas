---
import { t, getLocalePath, type Lang } from '../i18n/translations';
import type { Flat } from '../data/flats';

interface Props {
  flat: Flat;
  lang: Lang;
}

const { flat, lang } = Astro.props;
const availableCount = flat.rooms.filter(r => r.available).length;
const minPrice = Math.min(...flat.rooms.map(r => r.price));
---

<a href={getLocalePath(lang, `/pisos/${flat.slug}/`)} class="group block bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow overflow-hidden">
  <div class="aspect-[16/10] bg-primary-100 relative overflow-hidden">
    <div class="absolute inset-0 flex items-center justify-center text-primary-300">
      <svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-4 0a1 1 0 01-1-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 01-1 1" />
      </svg>
    </div>
    {availableCount > 0 && (
      <span class="absolute top-3 right-3 bg-green-500 text-white text-xs font-semibold px-2 py-1 rounded-full">
        {availableCount} {t(lang, 'flats.available').toLowerCase()}
      </span>
    )}
  </div>
  <div class="p-5">
    <h3 class="font-display text-lg font-semibold text-gray-900 group-hover:text-primary-700 transition-colors">
      {flat.name[lang]}
    </h3>
    <p class="text-sm text-gray-500 mt-1">{flat.neighborhood[lang]} &mdash; {flat.address}</p>
    <div class="flex items-center justify-between mt-4">
      <span class="text-sm text-gray-500">
        {flat.rooms.length} {t(lang, 'flats.rooms')}
      </span>
      <span class="text-primary-700 font-semibold">
        {t(lang, 'flats.from')} {minPrice}&euro;{t(lang, 'flats.month')}
      </span>
    </div>
  </div>
</a>
